<!DOCTYPE html>
<html>
<body>
<h1>PS2â†’USB (PS3 HID) Test</h1>
<button id="connect">Connect Controller</button>
<pre id="log"></pre>

<script>
  const log = (msg) => {
    document.getElementById("log").textContent = msg + "\n";
  };

  document.getElementById("connect").onclick = async () => {
    try {

      const filters = [{ vendorId: 0x054c, productId: 0x0268 }]; // Sony PS3 VID/PID
      const [device] = await navigator.hid.requestDevice({ filters });
      if (!device) {
        log("No device selected.");
        return;
      }

      await device.open();
      log("Connected to: " + device.productName);

      // --- Send "magic" feature report to wake the PS3 controller ---
      // This is the standard HID "Set Report" init for PS3 pads
      const wakeup = new Uint8Array([0x42, 0x0c, 0x00, 0x00]);
      await device.sendFeatureReport(0xf4, wakeup);
      log("Sent wake-up feature report");

      // Listen for input reports
      device.addEventListener("inputreport", (event) => {
        const { data, reportId } = event;
        const bytes = new Uint8Array(data.buffer);
        log(`Report ${reportId}: ${Array.from(bytes).map(b => b.toString(16).padStart(2,"0")).join(" ")}`);
      });
    } catch (err) {
      log("Error: " + err);
    }
  };
</script>
</body>
</html>
